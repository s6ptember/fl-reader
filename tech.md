# Техническое задание: Веб-библиотека для чтения книг

## 1. Общее описание проекта

Веб-приложение для поиска, скачивания и чтения книг с интеграцией Флибусты. Приложение позволяет пользователям искать книги на Флибусте, скачивать их на сервер в формате FB2, и читать непосредственно в браузере с сохранением прогресса чтения.

---

## 2. Технологический стек

| Компонент       | Технология                      |
| --------------- | ------------------------------- |
| Backend         | Django 5.x                      |
| Frontend        | HTMX + Alpine.js + Tailwind CSS |
| База данных     | SQLite (по умолчанию Django)    |
| Язык интерфейса | Русский                         |
| Сеть            | Tor (для доступа к .onion)      |

---

## 3. Функциональные требования

### 3.1. Главная страница (Библиотека)

- Отображение всех книг в виде сетки карточек
- Каждая карточка содержит:
    - Обложку книги
    - Название
    - Автор
- Поле поиска в верхней части страницы
- При клике на карточку — переход на страницу чтения

### 3.2. Поиск и скачивание книг

- Поле поиска отправляет запрос на .onion сайт Флибусты через Tor
- Результаты поиска отображаются в виде списка найденных книг
- Каждый результат содержит:
    - Название
    - Автор
    - Кнопка "Скачать"
- При скачивании:
    - Книга загружается в формате FB2 на сервер
    - Парсится метаинформация (название, автор, обложка)
    - Создаётся запись в базе данных
    - Карточка книги появляется в библиотеке

### 3.3. Страница чтения

- Отображение текста книги с постраничной/поточной навигацией
- Автоматическое сохранение прогресса чтения (в процентах)
- При клике на центр экрана — всплывающее меню с:
    - Индикатором прогресса чтения (%)
    - Настройками размера шрифта
    - Выбором цветовой темы (светлая/тёмная/сепия)

### 3.4. Хранение данных

- Файлы книг (FB2) хранятся на сервере
- Обложки извлекаются из FB2 и сохраняются отдельно
- Прогресс чтения сохраняется для каждой книги

---

## 4. Нефункциональные требования

### 4.1. Архитектура кода

- Принципы DRY (Don't Repeat Yourself)
- ООП-подход с использованием классов и сервисов
- Маппинг данных при необходимости (DTO/сериализаторы)
- Разделение логики: views, services, repositories

### 4.2. Безопасность

- Валидация и санитизация пользовательского ввода
- Защита от XSS/CSRF
- Безопасная работа с файлами (проверка типов, ограничение размера)
- Изоляция Tor-запросов

### 4.3. Фронтенд

- SPA-подобное поведение через HTMX
- Интерактивность через Alpine.js
- Стилизация через Tailwind CSS
- Без перезагрузки страницы при навигации

### 4.4. Код

- Без комментариев в коде
- Чистый, читаемый код с понятными именами

---

## 5. Структура проекта

```
library/
├── manage.py
├── config/
│   ├── settings.py
│   ├── urls.py
│   └── wsgi.py
├── books/
│   ├── models.py
│   ├── views.py
│   ├── urls.py
│   ├── services/
│   │   ├── flibusta_service.py
│   │   ├── fb2_parser.py
│   │   └── reading_service.py
│   └── templates/
│       └── books/
├── static/
│   ├── css/
│   └── js/
└── media/
    ├── books/
    └── covers/
```

---

## 6. Модели данных

### Book

|Поле|Тип|Описание|
|---|---|---|
|id|UUID|Уникальный идентификатор|
|title|CharField|Название книги|
|author|CharField|Автор|
|cover|ImageField|Путь к обложке|
|file|FileField|Путь к FB2 файлу|
|flibusta_id|CharField|ID на Флибусте (опционально)|
|reading_progress|IntegerField|Прогресс чтения (0-100)|
|created_at|DateTimeField|Дата добавления|

---

## 7. API Endpoints

|Метод|URL|Описание|
|---|---|---|
|GET|`/`|Главная страница с библиотекой|
|GET|`/book/<id>/`|Страница чтения книги|
|POST|`/book/<id>/progress/`|Сохранение прогресса|
|GET|`/search/?q=`|Поиск на Флибусте|
|POST|`/download/`|Скачивание книги с Флибусты|
|DELETE|`/book/<id>/delete/`|Удаление книги|

---

## 8. Пользовательские настройки чтения

|Параметр|Значения|
|---|---|
|Размер шрифта|Маленький / Средний / Большой|
|Цветовая тема|Светлая / Тёмная / Сепия|

Настройки сохраняются в localStorage браузера.

---

## 9. Зависимости

```
Django>=5.0
requests[socks]
PySocks
lxml
Pillow
```

---

## 10. Ограничения и допущения

- Приложение рассчитано на одного пользователя (без аутентификации)
- Tor должен быть запущен на сервере (SOCKS5 прокси на порту 9050)
- Поддерживается только формат FB2
- Флибуста доступна через .onion адрес
